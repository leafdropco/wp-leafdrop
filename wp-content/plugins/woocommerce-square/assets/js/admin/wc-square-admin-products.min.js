"use strict";(function(){var e=[].indexOf;jQuery(document).ready(function(i){var r,t,n,a,s,o,c,d,_,u,p,l,f,h,m,k,v,g,w,y,q,b;if(b=null!=(v=window.typenow)?v:"",k=null!=(g=window.pagenow)?g:"","product"===b&&wc_square_admin_products.is_product_sync_enabled)return"edit-product"===k&&i("#the-list").on("click",".editinline",function(){var e,r,t;return e=i(this).closest("tr"),t=e.find("th.check-column input").val(),r={action:"wc_square_get_quick_edit_product_details",security:wc_square_admin_products.get_quick_edit_product_details_nonce,product_id:e.find("th.check-column input").val()},i.post(wc_square_admin_products.ajax_url,r,function(e){var r,n,a,s,o,c,d,_,u,p,l,f;if(r=i("tr#edit-"+t),d=r.find("select.square-synced"),n=r.find(".wc-square-sync-with-square-errors"),!e.success&&e.data){if("multiple_attributes"===e.data)return d.prop("checked",!1),d.prop("disabled",!0),void n.find(".multiple_attributes").show();if("missing_variation_sku"===e.data)return d.prop("checked",!1),d.prop("disabled",!0),void n.find(".missing_variation_sku").show()}return c=r.find("input[name=_sku]"),u=r.find("select[name=_stock_status]"),_=r.find("input[name=_stock]"),o=r.find(".manage_stock_field .manage_stock"),s=r.find("input[name=_manage_stock]"),a='<span class="description"><a href="'+wc_square_admin_products.settings_url+'">'+wc_square_admin_products.i18n.synced_with_square+"</a></span>",p=e.data.edit_url,l=e.data.i18n,f=e.data.is_variable,d.val(e.data.is_synced_with_square),c.on("change keyup keypress",function(e){return""!==i(this).val()||f?(d.prop("disabled",!1),d.trigger("change"),n.find(".missing_sku").hide()):(d.val("no"),d.prop("disabled",!0),n.find(".missing_sku").show())}).trigger("change"),d.on("change",function(e){return"no"===i(this).val()?(s.off(),s.add(_).css({opacity:1}),o.find(".description").remove(),f?s.is(":checked")?(i(".stock_qty_field").show(),i(".backorder_field").show()):i(".stock_status_field").show():(_.prop("readonly",!1),u.prop("readonly",!1))):(s.prop("checked",!0),s.on("click",function(){return!1}),s.add(_).css({opacity:"0.5"}),o.append(a),wc_square_admin_products.is_woocommerce_sor&&p&&l&&o.append('<p class="description"><a href="'+p+'">'+l+"</a></p>"),f?(i(".stock_status_field").hide(),i(".stock_qty_field").hide(),i(".backorder_field").hide()):(_.prop("readonly",!0),u.prop("readonly",!0)))}).trigger("change")})}),"product"===k?(y="#_"+wc_square_admin_products.synced_with_square_taxonomy,f=function(){var r;return r=i("#product-type").val(),e.call(wc_square_admin_products.variable_product_types,r)>=0},_=function(){return""!==i("#_sku").val().trim()},p=function(e){return!!e.length&&e.filter(function(){if(""!==i(this).val().trim())return!0}).length===e.length},u=function(e){var r;return r=e.map(function(e){return i(this).val()}),(r=i.makeArray(r)).every(function(e){return r.indexOf(e)===r.lastIndexOf(e)})},d=function(){var e;return e=i('.woocommerce_attribute_data input[name^="attribute_variation"]:checked'),f()&&e&&e.length>1},w=function(e){return i(".wc-square-sync-with-square-error."+e).show(),i(y).prop("disabled",!0),i(y).prop("checked",!1)},l=function(e){var r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(i(".wc-square-sync-with-square-error."+e).hide(),r)return i(y).prop("disabled",!1)},c=function(e){var r;return f()?(i("#_sku").off("change keypress keyup"),l("missing_sku",!d()),(r=i('input[id^="variable_sku"]')).on("change keypress keyup",function(t){return p(r)&&u(r)?l("missing_variation_sku",!d()):w("missing_variation_sku"),i(e).trigger("change")}).trigger("change")):(i('input[id^="variable_sku"]').off("change keypress keyup"),l("missing_variation_sku",!d()),i("#_sku").on("change keypress keyup",function(r){return""===i(this).val().trim()?w("missing_sku"):l("missing_sku",!d()),i(e).trigger("change")}).trigger("change"))},o=function(e){return i("#variable_product_options").on("reload",function(r){return d()?w("multiple_attributes"):l("multiple_attributes",f()?p:_()),i(e).trigger("change")}).trigger("reload")},q=function(){if(c(y),i(y).trigger("change"),f()&&!i('input[id^="variable_sku"]').length)return w("missing_variation_sku")},c(y),o(y),a=i(".stock_fields"),s=a.find("#_stock"),t=i("._manage_stock_field"),n=t.find("#_manage_stock"),r=t.find(".description"),h=r.text(),m=i("#_manage_stock").is(":checked"),i(y).on("change",function(e){var t,o;if(wc_square_admin_products.is_inventory_sync_enabled)return o=-1!==i.inArray(i("#product-type").val(),wc_square_admin_products.variable_product_types),i(this).is(":checked")&&i("#_square_item_variation_id").length>0?(t=!0,r.html('<a href="'+wc_square_admin_products.settings_url+'">'+wc_square_admin_products.i18n.synced_with_square+"</a>"),n.prop("disabled",!0).prop("checked",!o).change(),s.prop("readonly",!0),o||a.show(),wc_square_admin_products.is_woocommerce_sor&&!o?(0===i("p._stock_field span.description").length&&s.after('<span class="description" style="display:block;clear:both;"><a href="#" id="fetch-stock-with-square">'+wc_square_admin_products.i18n.fetch_stock_with_square+'</a><div class="spinner" style="float:none;"></div></span>'),i("#fetch-stock-with-square").on("click",function(e){var r,t;return e.preventDefault(),(r=i("p._stock_field span.description .spinner")).css("visibility","visible"),t={action:"wc_square_fetch_product_stock_with_square",security:wc_square_admin_products.fetch_product_stock_with_square_nonce,product_id:i("#post_ID").val()},i.post(wc_square_admin_products.ajax_url,t,function(e){var t;return e&&e.success?(t=e.data,s.val(t),a.find("input[name=_original_stock]").val(t),s.prop("readonly",!1),i("p._stock_field span.description").remove()):(e.data&&(i(".inventory-fetch-error").remove(),r.after('<span class="inventory-fetch-error" style="display:inline-block;color:red;">'+e.data+"</span>")),r.css("visibility","hidden"),console.log(e))})})):wc_square_admin_products.is_square_sor&&0===i("p._stock_field span.description").length&&s.after('<span class="description" style="display:block;clear:both;">'+wc_square_admin_products.i18n.managed_by_square+"</span>")):(t=!1,i("p._stock_field span.description").remove(),s.prop("readonly",!1),r.html(h),n.prop("disabled",!1).prop("checked",m),m&&a.show()),i(".woocommerce_variation").each(function(){var e,r,n,a,s,o;return o=i(this).find("h3 > a").attr("rel"),r=i(this).find("#wc_square_variation_manage_stock"),e=r.parent(),a=i(this).find(".wc_input_stock"),n=a.parent(),t?(r.prop("disabled",!0).prop("checked",!0).change(),a.prop("readonly",!0),i("#wc_square_variation_manage_stock").prop("disabled",!1),0===e.find(".description").length&&r.after('<span class="description">('+wc_square_admin_products.i18n.managed_by_square+")</span>"),wc_square_admin_products.is_woocommerce_sor?(s="fetch-stock-with-square-"+o,0===n.find("span.description").length&&a.after('<span class="description" style="display:block;clear:both;"><a href="#" id="'+s+'">'+wc_square_admin_products.i18n.fetch_stock_with_square+'</a><div class="spinner" style="float:none;"></div></span>'),i("#"+s).on("click",function(e){var r,t;return e.preventDefault(),(r=i(this).next(".spinner")).css("visibility","visible"),t={action:"wc_square_fetch_product_stock_with_square",security:wc_square_admin_products.fetch_product_stock_with_square_nonce,product_id:o},i.post(wc_square_admin_products.ajax_url,t,function(e){var t;return e&&e.success?(t=e.data,a.val(t),n.parent().find('input[name^="variable_original_stock"]').val(t),a.prop("readonly",!1),n.find(".description").remove()):(e.data&&(i(".inventory-fetch-error").remove(),r.after('<span class="inventory-fetch-error" style="display:inline-block;color:red;">'+e.data+"</span>")),r.css("visibility","hidden"),console.log(e))})})):void 0):(a.prop("readonly",!1),r.prop("disabled",!1),r.next(".description").remove(),i(this).find("#wc_square_variation_manage_stock").prop("disabled",!0))})}).trigger("change"),i("#product-type").on("change",function(e){return q()}),i("#woocommerce-product-data").on("woocommerce_variations_loaded woocommerce_variations_added woocommerce_variations_removed",function(e){return q()})):void 0})}).call(void 0);
//# sourceMappingURL=wc-square-admin-products.min.js.map